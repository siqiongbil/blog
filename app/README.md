# åšå®¢ç³»ç»Ÿåç«¯ API æœåŠ¡

è¿™æ˜¯ä¸€ä¸ªåŸºäº Node.js å’Œ Express æ„å»ºçš„ç°ä»£åŒ–åšå®¢ç³»ç»Ÿåç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„å†…å®¹ç®¡ç†ã€ç”¨æˆ·è®¤è¯ã€æ–‡ä»¶ä¸Šä¼ ã€è®¿é—®ç»Ÿè®¡ç­‰åŠŸèƒ½ã€‚

## ğŸš€ ä¸»è¦ç‰¹æ€§

- **æ–‡ç« ç®¡ç†**ï¼šæ”¯æŒæ–‡ç« çš„å¢åˆ æ”¹æŸ¥ã€åˆ†ç±»ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿ
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†
- **æ–‡ä»¶ç®¡ç†**ï¼šå›¾ç‰‡ä¸Šä¼ ã€éŸ³ä¹æ–‡ä»¶ç®¡ç†ã€æ–‡ä»¶å­˜å‚¨
- **è®¿é—®ç»Ÿè®¡**ï¼šè¯¦ç»†çš„è®¿é—®è®°å½•å’Œæ•°æ®åˆ†æ
- **SEOä¼˜åŒ–**ï¼šsitemapç”Ÿæˆã€IndexNowæ”¯æŒ
- **ç³»ç»Ÿé…ç½®**ï¼šçµæ´»çš„ç³»ç»Ÿå‚æ•°é…ç½®
- **å®‰å…¨é˜²æŠ¤**ï¼šJWTè®¤è¯ã€è®¿é—®æ§åˆ¶ã€æ•°æ®éªŒè¯

## ğŸ“ é¡¹ç›®ç»“æ„

```
app/
â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ db.js        # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ tracking.js  # è®¿é—®è·Ÿè¸ªé…ç½®
â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨å±‚
â”œâ”€â”€ dao/            # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”œâ”€â”€ routes/         # è·¯ç”±å®šä¹‰
â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/        # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ sql/           # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ files/         # æ–‡ä»¶å­˜å‚¨ç›®å½•
â”œâ”€â”€ image/         # å›¾ç‰‡å­˜å‚¨ç›®å½•
â”œâ”€â”€ music/         # éŸ³ä¹æ–‡ä»¶ç›®å½•
â””â”€â”€ index.js       # åº”ç”¨å…¥å£æ–‡ä»¶
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œç¯å¢ƒ**ï¼šNode.js
- **Webæ¡†æ¶**ï¼šExpress.js
- **æ•°æ®åº“**ï¼šMySQL
- **è®¤è¯**ï¼šJWT (JSON Web Token)
- **æ–‡ä»¶ä¸Šä¼ **ï¼šMulter
- **å¯†ç åŠ å¯†**ï¼šbcryptjs
- **è·¨åŸŸå¤„ç†**ï¼šCORS

## ğŸ“¦ å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- Node.js >= 14.0.0
- MySQL >= 5.7
- npm æˆ– yarn

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¯å¢ƒé…ç½®

1. åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```env
DB_HOST=localhost
DB_USER=your_username
DB_PASSWORD=your_password
DB_NAME=blog_db
JWT_SECRET=your_jwt_secret
NODE_ENV=development
```

2. å¯¼å…¥æ•°æ®åº“ç»“æ„ï¼š

```bash
mysql -u username -p database_name < sql/blog.sql
```

### å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

æœåŠ¡å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚

## ğŸ”§ API æ¥å£

### æ–‡ç« ç›¸å…³

- `GET /api/articles` - è·å–æ–‡ç« åˆ—è¡¨
- `GET /api/articles/:id` - è·å–æ–‡ç« è¯¦æƒ…
- `POST /api/articles` - åˆ›å»ºæ–‡ç« ï¼ˆéœ€è¦è®¤è¯ï¼‰
- `PUT /api/articles/:id` - æ›´æ–°æ–‡ç« ï¼ˆéœ€è¦è®¤è¯ï¼‰
- `DELETE /api/articles/:id` - åˆ é™¤æ–‡ç« ï¼ˆéœ€è¦è®¤è¯ï¼‰

### ç”¨æˆ·ç›¸å…³

- `POST /api/users/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/users/login` - ç”¨æˆ·ç™»å½•
- `GET /api/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰

### æ–‡ä»¶ç®¡ç†

- `POST /api/images/upload` - å›¾ç‰‡ä¸Šä¼ 
- `POST /api/files/upload` - æ–‡ä»¶ä¸Šä¼ 
- `POST /api/music/upload` - éŸ³ä¹ä¸Šä¼ 

### è®¿é—®ç»Ÿè®¡

- `GET /api/articles/:id/visit-stats` - è·å–æ–‡ç« è®¿é—®ç»Ÿè®¡
- `GET /api/analytics/trends` - è·å–è®¿é—®è¶‹åŠ¿
- `GET /api/analytics/hot-articles` - è·å–çƒ­é—¨æ–‡ç« 

## ğŸ”’ è®¿é—®æ§åˆ¶

ç³»ç»Ÿæ”¯æŒæ™ºèƒ½è®¿é—®è®°å½•è¿‡æ»¤ï¼Œå¯ä»¥è·³è¿‡ç‰¹å®šåŸŸåã€çˆ¬è™«å’Œå¼€å‘å·¥å…·çš„è®¿é—®è®°å½•ï¼š

- **åŸŸåè¿‡æ»¤**ï¼šç®¡ç†åå°ã€æµ‹è¯•ç¯å¢ƒç­‰åŸŸå
- **çˆ¬è™«æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«æœç´¢å¼•æ“çˆ¬è™«
- **å¼€å‘å·¥å…·**ï¼šè¿‡æ»¤ Postmanã€curl ç­‰å·¥å…·è¯·æ±‚

è¯¦ç»†é…ç½®è¯·å‚è€ƒ [è®¿é—®è®°å½•è·Ÿè¸ªåŠŸèƒ½è¯´æ˜](./README_TRACKING.md)ã€‚

## ğŸ³ Docker éƒ¨ç½²

é¡¹ç›®æ”¯æŒ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼š

```bash
# æ„å»ºé•œåƒ
docker build -t blog-api .

# è¿è¡Œå®¹å™¨
docker-compose up -d
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

ä¸»è¦æ•°æ®è¡¨ï¼š

- `articles` - æ–‡ç« è¡¨
- `categories` - åˆ†ç±»è¡¨
- `tags` - æ ‡ç­¾è¡¨
- `users` - ç”¨æˆ·è¡¨
- `article_visits` - è®¿é—®è®°å½•è¡¨
- `system_config` - ç³»ç»Ÿé…ç½®è¡¨

## ğŸ”§ å¼€å‘å·¥å…·

### è„šæœ¬å‘½ä»¤

- `scripts/auto-cleanup.js` - è‡ªåŠ¨æ¸…ç†è¿‡æœŸæ•°æ®
- `scripts/fix-image-urls.js` - ä¿®å¤å›¾ç‰‡URL
- `utils/initAdmin.js` - åˆå§‹åŒ–ç®¡ç†å‘˜è´¦æˆ·

### å®ç”¨å·¥å…·

- `utils/visitUtils.js` - è®¿é—®æ•°æ®å¤„ç†å·¥å…·
- `utils/ipLocationService.js` - IPåœ°ç†ä½ç½®æœåŠ¡
- `utils/musicImporter.js` - éŸ³ä¹æ–‡ä»¶å¯¼å…¥å·¥å…·

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ç´¢å¼•**ï¼šå…³é”®å­—æ®µå»ºç«‹ç´¢å¼•
- **ç¼“å­˜ç­–ç•¥**ï¼šé™æ€æ–‡ä»¶ç¼“å­˜
- **å‹ç¼©ä¼ è¾“**ï¼šgzipå‹ç¼©
- **è®¿é—®æ§åˆ¶**ï¼šæ™ºèƒ½è¿‡æ»¤æ— æ•ˆè¯·æ±‚

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **JWTè®¤è¯**ï¼šå®‰å…¨çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- **å¯†ç åŠ å¯†**ï¼šbcryptåŠ å¯†å­˜å‚¨
- **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢SQLæ³¨å…¥å’ŒXSSæ”»å‡»
- **è®¿é—®é™åˆ¶**ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶

## ğŸ“ æ—¥å¿—è®°å½•

ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼š

- è®¿é—®æ—¥å¿—
- é”™è¯¯æ—¥å¿—
- æ“ä½œæ—¥å¿—
- æ€§èƒ½ç›‘æ§

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ Issue
- å‘é€é‚®ä»¶
- é¡¹ç›®è®¨è®ºåŒº

---

**æ³¨æ„**ï¼šè¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡å’Œå®‰å…¨è®¾ç½®ã€‚