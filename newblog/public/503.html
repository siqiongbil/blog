<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>503 - æœåŠ¡ä¸å¯ç”¨</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        max-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        margin: 0;
        padding: 10px;
        overflow: hidden;
      }

      .error-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        max-width: 1600px;
        width: 100%;
        max-height: 95vh;
        overflow-y: auto;
        overflow-x: hidden;
        box-sizing: border-box;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
      }

      /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
      .error-container::-webkit-scrollbar {
        width: 6px;
      }

      .error-container::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
      }

      .error-container::-webkit-scrollbar-thumb {
        background: rgba(171, 71, 188, 0.6);
        border-radius: 3px;
      }

      .error-container::-webkit-scrollbar-thumb:hover {
        background: rgba(171, 71, 188, 0.8);
      }

      .error-code {
        font-size: 5.5rem;
        font-weight: 900;
        background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
        margin-bottom: 0.8rem;
        text-shadow: 0 0 30px rgba(171, 71, 188, 0.5);
      }

      .error-title {
        font-size: 1.8rem;
        margin-bottom: 0.8rem;
        color: #fff;
      }

      .error-description {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 1.5rem;
        line-height: 1.5;
      }

      .error-actions {
        margin-top: 1rem;
      }

      .btn {
        display: inline-block;
        padding: 12px 24px;
        margin: 0 8px 8px 0;
        text-decoration: none;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        font-size: 1rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
      }

      .btn-secondary {
        background: transparent;
        color: #4facfe;
        border: 2px solid #4facfe;
      }

      .btn-secondary:hover {
        background: #4facfe;
        color: white;
        transform: translateY(-2px);
      }

      .error-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.7;
      }

      .maintenance-info {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 10px;
        margin: 1rem 0;
        font-size: 0.9rem;
      }

      .error-info {
        flex: 0.8;
        text-align: center;
        min-width: 280px;
        max-width: 400px;
      }

      .game-section {
        flex: 1.2;
        min-width: 600px;
        max-width: 900px;
      }

      .chess-game {
        margin: 0;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        height: 100%;
        box-sizing: border-box;
      }

      .game-layout {
        display: flex !important;
        flex-direction: row !important;
        gap: 1.5rem;
        align-items: flex-start;
        justify-content: center;
        flex-wrap: nowrap;
      }

      .game-board {
        flex-shrink: 0;
        flex-basis: auto;
      }

      .game-canvas {
        width: 460px !important;
        height: 500px !important;
        max-width: none;
        max-height: none;
      }

      .game-sidebar {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-width: 200px;
        flex-shrink: 0;
        flex-basis: auto;
      }

      .game-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.8rem;
        font-size: 1rem;
      }

      .current-player {
        color: #ab47bc;
        font-weight: 600;
      }

      .game-winner {
        color: #4caf50;
        font-weight: 600;
      }

      .game-controls {
        margin: 0.8rem 0;
      }

      .game-instructions {
        margin-top: 0.8rem;
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
      }

      .game-instructions p {
        margin: 0.3rem 0;
      }

      .btn-game {
        background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
        color: white;
        border: none;
        margin: 0 5px;
      }

      .btn-game:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(171, 71, 188, 0.4);
      }

      @media (max-width: 768px) {
        body {
          padding: 5px;
        }

        .error-code {
          font-size: 3.5rem;
          margin-bottom: 0.5rem;
        }

        .error-title {
          font-size: 1.3rem;
          margin-bottom: 0.5rem;
        }

        .error-description {
          font-size: 0.9rem;
          margin-bottom: 1rem;
        }

        .error-container {
          padding: 1.5rem 1rem;
          max-height: 98vh;
        }

        .btn {
          display: block;
          margin: 8px 0;
          width: 100%;
          padding: 12px;
          font-size: 0.9rem;
        }

        .chess-game {
          margin: 1rem 0;
          padding: 0.5rem;
        }

        .game-canvas {
          width: 100%;
          max-width: 360px;
          height: auto;
        }

        .game-info {
          flex-direction: column;
          gap: 0.3rem;
          text-align: center;
          font-size: 0.9rem;
        }

        .btn-game {
          font-size: 0.8rem;
          padding: 8px 16px;
          margin: 3px 0;
          width: 100%;
        }
      }

      @media (max-height: 600px) {
        .error-code {
          font-size: 3rem;
          margin-bottom: 0.3rem;
        }

        .error-title {
          font-size: 1.2rem;
          margin-bottom: 0.3rem;
        }

        .error-description {
          font-size: 0.8rem;
          margin-bottom: 0.8rem;
        }

        .error-container {
          padding: 1rem 0.8rem;
        }

        .chess-game {
          margin: 0.5rem 0;
          padding: 0.3rem;
        }

        .game-canvas {
          max-width: 300px;
          height: auto;
        }
      }

      @media (max-width: 768px) {
        .error-container {
          flex-direction: column;
          gap: 1rem;
        }

        .error-info {
          min-width: auto;
          text-align: center;
        }

        .game-section {
          min-width: auto;
        }

        .game-layout {
          flex-direction: column;
          align-items: center;
        }

        .game-sidebar {
          min-width: auto;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="error-container">
      <!-- å·¦ä¾§ï¼šé”™è¯¯ä¿¡æ¯å’ŒæŒ‰é’® -->
      <div class="error-info">
        <div class="error-icon">ğŸ”§</div>
        <div class="error-code">503</div>
        <h1 class="error-title">æœåŠ¡ä¸å¯ç”¨</h1>
        <p class="error-description">
          æœåŠ¡å™¨å½“å‰æ— æ³•å¤„ç†è¯·æ±‚ã€‚è¿™å¯èƒ½æ˜¯ç”±äºç³»ç»Ÿç»´æŠ¤æˆ–æœåŠ¡å™¨è¿‡è½½é€ æˆçš„ä¸´æ—¶çŠ¶å†µã€‚ä¸è¿‡ï¼Œæ¥ç©ä¸ªè±¡æ£‹æ¸¸æˆæ”¾æ¾ä¸€ä¸‹å§ï¼
        </p>

        <div class="maintenance-info">
          <p>
            å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼š<br />
            ğŸ“§ 18955628948@163.com
          </p>
        </div>

        <div class="error-actions">
          <a href="/" class="btn btn-primary">è¿”å›é¦–é¡µ</a>
          <a href="javascript:location.reload()" class="btn btn-secondary">é‡æ–°åŠ è½½</a>
        </div>
      </div>

      <!-- å³ä¾§ï¼šå°æ¸¸æˆ -->
      <div class="game-section">
        <div class="chess-game">
          <div class="game-layout">
            <div class="game-board">
              <canvas id="chessCanvas" class="game-canvas" width="460" height="500"></canvas>
            </div>

            <div class="game-sidebar">
              <div class="game-info">
                <span class="current-player"
                  >å½“å‰ç©å®¶:
                  <span id="chess-current-player" style="color: #ff5722">çº¢æ–¹</span></span
                >
                <span id="chess-winner" class="game-winner" style="display: none"></span>
              </div>

              <div class="game-controls">
                <button id="chessStartBtn" class="btn btn-game">å¼€å§‹æ¸¸æˆ</button>
                <button id="chessResetBtn" class="btn btn-game">é‡ç½®æ£‹ç›˜</button>
              </div>

              <div class="game-instructions">
                <p>ç‚¹å‡»æ£‹å­é€‰æ‹©ï¼Œå†ç‚¹å‡»ç›®æ ‡ä½ç½®ç§»åŠ¨</p>
                <p>çº¢æ–¹å…ˆæ‰‹ï¼Œé»‘æ–¹åæ‰‹</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // ç®€åŒ–è±¡æ£‹æ¸¸æˆé€»è¾‘
      const canvas = document.getElementById('chessCanvas')
      const ctx = canvas.getContext('2d')
      const currentPlayerElement = document.getElementById('chess-current-player')
      const winnerElement = document.getElementById('chess-winner')
      const startBtn = document.getElementById('chessStartBtn')
      const resetBtn = document.getElementById('chessResetBtn')

      const CELL_SIZE = 46
      const BOARD_OFFSET = 25
      let currentPlayer = 1 // 1: çº¢æ–¹, 2: é»‘æ–¹
      let gameStarted = false
      let selectedPiece = null

      // æ£‹å­ç±»å‹å®šä¹‰
      const PIECES = {
        EMPTY: 0,
        // çº¢æ–¹ (1-7)
        R_KING: 1, // å¸…
        R_GUARD: 2, // ä»•
        R_ELEPHANT: 3, // ç›¸
        R_HORSE: 4, // é©¬
        R_ROOK: 5, // è½¦
        R_CANNON: 6, // ç‚®
        R_PAWN: 7, // å…µ
        // é»‘æ–¹ (8-14)
        B_KING: 8, // å°†
        B_GUARD: 9, // å£«
        B_ELEPHANT: 10, // è±¡
        B_HORSE: 11, // é©¬
        B_ROOK: 12, // è½¦
        B_CANNON: 13, // ç‚®
        B_PAWN: 14, // å’
      }

      // æ£‹å­åç§°
      const PIECE_NAMES = {
        1: 'å¸…',
        2: 'ä»•',
        3: 'ç›¸',
        4: 'é©¬',
        5: 'è½¦',
        6: 'ç‚®',
        7: 'å…µ',
        8: 'å°†',
        9: 'å£«',
        10: 'è±¡',
        11: 'é©¬',
        12: 'è½¦',
        13: 'ç‚®',
        14: 'å’',
      }

      // æ ‡å‡†è±¡æ£‹å¼€å±€æ£‹ç›˜
      let board = [
        [12, 11, 10, 9, 8, 9, 10, 11, 12],
        [0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 13, 0, 0, 0, 0, 0, 13, 0],
        [14, 0, 14, 0, 14, 0, 14, 0, 14],
        [0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0],
        [7, 0, 7, 0, 7, 0, 7, 0, 7],
        [0, 6, 0, 0, 0, 0, 0, 6, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0],
        [5, 4, 3, 2, 1, 2, 3, 4, 5],
      ]

      function drawBoard() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)

        // ç»˜åˆ¶èƒŒæ™¯
        ctx.fillStyle = '#deb887'
        ctx.fillRect(0, 0, canvas.width, canvas.height)

        // ç»˜åˆ¶ç½‘æ ¼çº¿
        ctx.strokeStyle = '#000'
        ctx.lineWidth = 2

        for (let i = 0; i < 9; i++) {
          // å‚ç›´çº¿
          ctx.beginPath()
          ctx.moveTo(BOARD_OFFSET + i * CELL_SIZE, BOARD_OFFSET)
          ctx.lineTo(BOARD_OFFSET + i * CELL_SIZE, BOARD_OFFSET + 9 * CELL_SIZE)
          ctx.stroke()
        }

        for (let i = 0; i < 10; i++) {
          // æ°´å¹³çº¿
          ctx.beginPath()
          ctx.moveTo(BOARD_OFFSET, BOARD_OFFSET + i * CELL_SIZE)
          ctx.lineTo(BOARD_OFFSET + 8 * CELL_SIZE, BOARD_OFFSET + i * CELL_SIZE)
          ctx.stroke()
        }

        // ç»˜åˆ¶æ¥šæ²³æ±‰ç•Œ
        ctx.fillStyle = '#000'
        ctx.font = '16px Arial'
        ctx.textAlign = 'center'
        ctx.fillText('æ¥šæ²³', BOARD_OFFSET + 2 * CELL_SIZE, BOARD_OFFSET + 4.7 * CELL_SIZE)
        ctx.fillText('æ±‰ç•Œ', BOARD_OFFSET + 6 * CELL_SIZE, BOARD_OFFSET + 4.7 * CELL_SIZE)

        // ç»˜åˆ¶æ£‹å­
        for (let row = 0; row < 10; row++) {
          for (let col = 0; col < 9; col++) {
            if (board[row][col] !== 0) {
              drawPiece(col, row, board[row][col])
            }
          }
        }

        // ç»˜åˆ¶é€‰ä¸­æ£‹å­çš„é«˜äº®
        if (selectedPiece) {
          ctx.strokeStyle = '#ff0'
          ctx.lineWidth = 3
          ctx.beginPath()
          const x = BOARD_OFFSET + selectedPiece.col * CELL_SIZE
          const y = BOARD_OFFSET + selectedPiece.row * CELL_SIZE
          ctx.arc(x, y, 18, 0, 2 * Math.PI)
          ctx.stroke()
        }
      }

      function drawPiece(col, row, piece) {
        const x = BOARD_OFFSET + col * CELL_SIZE
        const y = BOARD_OFFSET + row * CELL_SIZE
        const radius = 18

        // åˆ¤æ–­çº¢æ–¹è¿˜æ˜¯é»‘æ–¹
        const isRed = piece >= 1 && piece <= 7

        // ç»˜åˆ¶æ£‹å­åœ†åœˆ
        ctx.beginPath()
        ctx.arc(x, y, radius, 0, 2 * Math.PI)
        ctx.fillStyle = isRed ? '#ff5722' : '#333'
        ctx.fill()
        ctx.strokeStyle = '#000'
        ctx.lineWidth = 2
        ctx.stroke()

        // ç»˜åˆ¶æ£‹å­æ–‡å­—
        ctx.fillStyle = '#fff'
        ctx.font = 'bold 14px Arial'
        ctx.textAlign = 'center'
        ctx.textBaseline = 'middle'
        ctx.fillText(PIECE_NAMES[piece] || '?', x, y)
      }

      function getBoardPosition(event) {
        const rect = canvas.getBoundingClientRect()
        const x = event.clientX - rect.left
        const y = event.clientY - rect.top

        const col = Math.round((x - BOARD_OFFSET) / CELL_SIZE)
        const row = Math.round((y - BOARD_OFFSET) / CELL_SIZE)

        return { row, col }
      }

      function isValidPosition(row, col) {
        return row >= 0 && row < 10 && col >= 0 && col < 9
      }

      function isRedPiece(piece) {
        return piece >= 1 && piece <= 7
      }

      function isBlackPiece(piece) {
        return piece >= 8 && piece <= 14
      }

      function isSameTeam(piece1, piece2) {
        return (
          (isRedPiece(piece1) && isRedPiece(piece2)) ||
          (isBlackPiece(piece1) && isBlackPiece(piece2))
        )
      }

      function isValidMove(fromRow, fromCol, toRow, toCol) {
        if (!isValidPosition(toRow, toCol)) return false

        const piece = board[fromRow][fromCol]
        const target = board[toRow][toCol]

        // ä¸èƒ½åƒè‡ªå·±çš„æ£‹å­
        if (target !== 0 && isSameTeam(piece, target)) return false

        const rowDiff = Math.abs(toRow - fromRow)
        const colDiff = Math.abs(toCol - fromCol)

        switch (piece) {
          case PIECES.R_KING:
          case PIECES.B_KING:
            return isValidKingMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_GUARD:
          case PIECES.B_GUARD:
            return isValidGuardMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_ELEPHANT:
          case PIECES.B_ELEPHANT:
            return isValidElephantMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_HORSE:
          case PIECES.B_HORSE:
            return isValidHorseMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_ROOK:
          case PIECES.B_ROOK:
            return isValidRookMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_CANNON:
          case PIECES.B_CANNON:
            return isValidCannonMove(fromRow, fromCol, toRow, toCol)

          case PIECES.R_PAWN:
          case PIECES.B_PAWN:
            return isValidPawnMove(fromRow, fromCol, toRow, toCol)

          default:
            return false
        }
      }

      function isValidKingMove(fromRow, fromCol, toRow, toCol) {
        const rowDiff = Math.abs(toRow - fromRow)
        const colDiff = Math.abs(toCol - fromCol)

        // å¸…/å°†åªèƒ½åœ¨ä¹å®«æ ¼å†…ç§»åŠ¨
        const piece = board[fromRow][fromCol]
        const isRed = isRedPiece(piece)

        if (isRed) {
          // çº¢æ–¹ä¹å®«æ ¼ (7-9è¡Œ, 3-5åˆ—)
          if (toRow < 7 || toRow > 9 || toCol < 3 || toCol > 5) return false
        } else {
          // é»‘æ–¹ä¹å®«æ ¼ (0-2è¡Œ, 3-5åˆ—)
          if (toRow < 0 || toRow > 2 || toCol < 3 || toCol > 5) return false
        }

        // åªèƒ½èµ°ä¸€æ ¼
        return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1)
      }

      function isValidGuardMove(fromRow, fromCol, toRow, toCol) {
        const rowDiff = Math.abs(toRow - fromRow)
        const colDiff = Math.abs(toCol - fromCol)

        // ä»•/å£«åªèƒ½åœ¨ä¹å®«æ ¼å†…æ–œç€èµ°
        const piece = board[fromRow][fromCol]
        const isRed = isRedPiece(piece)

        if (isRed) {
          if (toRow < 7 || toRow > 9 || toCol < 3 || toCol > 5) return false
        } else {
          if (toRow < 0 || toRow > 2 || toCol < 3 || toCol > 5) return false
        }

        return rowDiff === 1 && colDiff === 1
      }

      function isValidElephantMove(fromRow, fromCol, toRow, toCol) {
        const rowDiff = toRow - fromRow
        const colDiff = toCol - fromCol

        // ç›¸/è±¡èµ°"ç”°"å­—ï¼Œä¸èƒ½è¿‡æ²³
        if (Math.abs(rowDiff) !== 2 || Math.abs(colDiff) !== 2) return false

        const piece = board[fromRow][fromCol]
        const isRed = isRedPiece(piece)

        if (isRed && toRow < 5) return false // çº¢ç›¸ä¸èƒ½è¿‡æ²³
        if (!isRed && toRow > 4) return false // é»‘è±¡ä¸èƒ½è¿‡æ²³

        // æ£€æŸ¥å¡è±¡çœ¼
        const blockRow = fromRow + rowDiff / 2
        const blockCol = fromCol + colDiff / 2
        return board[blockRow][blockCol] === 0
      }

      function isValidHorseMove(fromRow, fromCol, toRow, toCol) {
        const rowDiff = Math.abs(toRow - fromRow)
        const colDiff = Math.abs(toCol - fromCol)

        // é©¬èµ°"æ—¥"å­—
        if (!((rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2))) {
          return false
        }

        // æ£€æŸ¥è¹©é©¬è…¿
        let blockRow, blockCol
        if (rowDiff === 2) {
          blockRow = fromRow + (toRow > fromRow ? 1 : -1)
          blockCol = fromCol
        } else {
          blockRow = fromRow
          blockCol = fromCol + (toCol > fromCol ? 1 : -1)
        }

        return board[blockRow][blockCol] === 0
      }

      function isValidRookMove(fromRow, fromCol, toRow, toCol) {
        // è½¦èµ°ç›´çº¿
        if (fromRow !== toRow && fromCol !== toCol) return false

        // æ£€æŸ¥è·¯å¾„æ˜¯å¦æœ‰éšœç¢
        return isPathClear(fromRow, fromCol, toRow, toCol)
      }

      function isValidCannonMove(fromRow, fromCol, toRow, toCol) {
        // ç‚®èµ°ç›´çº¿
        if (fromRow !== toRow && fromCol !== toCol) return false

        const target = board[toRow][toCol]
        const obstacles = countObstacles(fromRow, fromCol, toRow, toCol)

        if (target === 0) {
          // ç§»åŠ¨æ—¶ä¸èƒ½æœ‰éšœç¢
          return obstacles === 0
        } else {
          // åƒå­æ—¶å¿…é¡»æœ‰ä¸€ä¸ªç‚®æ¶
          return obstacles === 1
        }
      }

      function isValidPawnMove(fromRow, fromCol, toRow, toCol) {
        const piece = board[fromRow][fromCol]
        const isRed = isRedPiece(piece)
        const rowDiff = toRow - fromRow
        const colDiff = Math.abs(toCol - fromCol)

        // å…µ/å’åªèƒ½å‰è¿›
        if (isRed) {
          if (rowDiff > 0) return false // çº¢å…µä¸èƒ½åé€€
          if (fromRow > 4) {
            // æœªè¿‡æ²³ï¼Œåªèƒ½å‰è¿›
            return rowDiff === -1 && colDiff === 0
          } else {
            // å·²è¿‡æ²³ï¼Œå¯ä»¥å‰è¿›æˆ–å·¦å³ç§»åŠ¨
            return (rowDiff === -1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1)
          }
        } else {
          if (rowDiff < 0) return false // é»‘å’ä¸èƒ½åé€€
          if (fromRow < 5) {
            // æœªè¿‡æ²³ï¼Œåªèƒ½å‰è¿›
            return rowDiff === 1 && colDiff === 0
          } else {
            // å·²è¿‡æ²³ï¼Œå¯ä»¥å‰è¿›æˆ–å·¦å³ç§»åŠ¨
            return (rowDiff === 1 && colDiff === 0) || (rowDiff === 0 && colDiff === 1)
          }
        }
      }

      function isPathClear(fromRow, fromCol, toRow, toCol) {
        return countObstacles(fromRow, fromCol, toRow, toCol) === 0
      }

      function countObstacles(fromRow, fromCol, toRow, toCol) {
        let count = 0

        if (fromRow === toRow) {
          // æ°´å¹³ç§»åŠ¨
          const minCol = Math.min(fromCol, toCol)
          const maxCol = Math.max(fromCol, toCol)
          for (let col = minCol + 1; col < maxCol; col++) {
            if (board[fromRow][col] !== 0) count++
          }
        } else if (fromCol === toCol) {
          // å‚ç›´ç§»åŠ¨
          const minRow = Math.min(fromRow, toRow)
          const maxRow = Math.max(fromRow, toRow)
          for (let row = minRow + 1; row < maxRow; row++) {
            if (board[row][fromCol] !== 0) count++
          }
        }

        return count
      }

      function makeMove(row, col) {
        if (!gameStarted || !isValidPosition(row, col)) return

        if (selectedPiece) {
          // å°è¯•ç§»åŠ¨æ£‹å­
          const piece = board[selectedPiece.row][selectedPiece.col]
          const targetPiece = board[row][col]

          // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç©å®¶çš„æ£‹å­
          const isPieceRed = isRedPiece(piece)
          const isCurrentPlayerRed = currentPlayer === 1

          if (isPieceRed === isCurrentPlayerRed) {
            // éªŒè¯ç§»åŠ¨æ˜¯å¦åˆæ³•
            if (isValidMove(selectedPiece.row, selectedPiece.col, row, col)) {
              // æ£€æŸ¥æ˜¯å¦å°†å†›/å°†æ­»
              if (targetPiece === PIECES.R_KING || targetPiece === PIECES.B_KING) {
                const winnerName = currentPlayer === 1 ? 'çº¢æ–¹' : 'é»‘æ–¹'
                winnerElement.textContent = `${winnerName}è·èƒœï¼`
                winnerElement.style.display = 'inline'
                gameStarted = false
              }

              // æ‰§è¡Œç§»åŠ¨
              board[row][col] = piece
              board[selectedPiece.row][selectedPiece.col] = 0

              // åˆ‡æ¢ç©å®¶
              currentPlayer = currentPlayer === 1 ? 2 : 1
              updateCurrentPlayer()
            }
          }
          selectedPiece = null
        } else {
          // é€‰æ‹©æ£‹å­
          const piece = board[row][col]
          if (piece !== 0) {
            const isPieceRed = isRedPiece(piece)
            const isCurrentPlayerRed = currentPlayer === 1

            if (isPieceRed === isCurrentPlayerRed) {
              selectedPiece = { row, col }
            }
          }
        }

        drawBoard()
      }

      function updateCurrentPlayer() {
        if (currentPlayer === 1) {
          currentPlayerElement.textContent = 'çº¢æ–¹'
          currentPlayerElement.style.color = '#ff5722'
        } else {
          currentPlayerElement.textContent = 'é»‘æ–¹'
          currentPlayerElement.style.color = '#333'
        }
      }

      function startGame() {
        gameStarted = true
        winnerElement.style.display = 'none'
        startBtn.textContent = 'æ¸¸æˆè¿›è¡Œä¸­'
        startBtn.disabled = true
      }

      function resetGame() {
        board = [
          [12, 11, 10, 9, 8, 9, 10, 11, 12],
          [0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 13, 0, 0, 0, 0, 0, 13, 0],
          [14, 0, 14, 0, 14, 0, 14, 0, 14],
          [0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0],
          [7, 0, 7, 0, 7, 0, 7, 0, 7],
          [0, 6, 0, 0, 0, 0, 0, 6, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0],
          [5, 4, 3, 2, 1, 2, 3, 4, 5],
        ]
        currentPlayer = 1
        gameStarted = false
        selectedPiece = null
        winnerElement.style.display = 'none'
        updateCurrentPlayer()
        drawBoard()
        startBtn.textContent = 'å¼€å§‹æ¸¸æˆ'
        startBtn.disabled = false
      }

      // äº‹ä»¶ç›‘å¬å™¨
      canvas.addEventListener('click', (event) => {
        const { row, col } = getBoardPosition(event)
        makeMove(row, col)
      })

      startBtn.addEventListener('click', startGame)
      resetBtn.addEventListener('click', resetGame)

      // åˆå§‹åŒ–
      drawBoard()
      updateCurrentPlayer()
    </script>
  </body>
</html>
